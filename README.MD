# MCP Linker SDK

ä¸€ä¸ªç”¨äºç®¡ç†å’Œè°ƒç”¨ MCP (Model Context Protocol) æœåŠ¡çš„ Python SDKï¼Œæ”¯æŒå¤šæœåŠ¡æ³¨å†Œã€å·¥å…·å‘ç°å’Œå¼‚æ­¥æ‰§è¡Œã€‚

## ğŸ“‹ ç›®å½•

- [åŠŸèƒ½ç‰¹æ€§](#åŠŸèƒ½ç‰¹æ€§)
- [å®‰è£…](#å®‰è£…)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [æ ¸å¿ƒç»„ä»¶](#æ ¸å¿ƒç»„ä»¶)
- [ä½¿ç”¨æŒ‡å—](#ä½¿ç”¨æŒ‡å—)
- [é…ç½®æ–‡ä»¶æ ¼å¼](#é…ç½®æ–‡ä»¶æ ¼å¼)
- [AgentScope é›†æˆ](#agentscope-é›†æˆ)
- [ç¤ºä¾‹](#ç¤ºä¾‹)
- [API æ–‡æ¡£](#api-æ–‡æ¡£)
- [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
- [è®¸å¯è¯](#è®¸å¯è¯)

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- **å¤šæœåŠ¡ç®¡ç†**ï¼šæ”¯æŒåŒæ—¶æ³¨å†Œå’Œç®¡ç†å¤šä¸ª MCP æœåŠ¡
- **é…ç½®æ–‡ä»¶æ”¯æŒ**ï¼šä» JSON é…ç½®æ–‡ä»¶æ‰¹é‡æ³¨å†ŒæœåŠ¡
- **å·¥å…·å‘ç°**ï¼šè‡ªåŠ¨å‘ç°å’Œæ³¨å†ŒæœåŠ¡æä¾›çš„æ‰€æœ‰å·¥å…·
- **å¼‚æ­¥æ‰§è¡Œ**ï¼šåŸºäº asyncio çš„å¼‚æ­¥å·¥å…·è°ƒç”¨
- **AgentScope é›†æˆ**ï¼šæä¾› AgentScope æ¡†æ¶çš„å·¥å…·åŒ…è£…å™¨
- **HTTP æ— çŠ¶æ€å®¢æˆ·ç«¯**ï¼šä½¿ç”¨ streamable HTTP ä¼ è¾“åè®®
- **å®Œå–„çš„é”™è¯¯å¤„ç†**ï¼šè¯¦ç»†çš„å¼‚å¸¸ä¿¡æ¯å’Œæ—¥å¿—è®°å½•

## ğŸ“¦ å®‰è£…

### ä¾èµ–è¦æ±‚

```bash
pip install agentscope mcp
```

### ä»æºç å®‰è£…

```bash
git clone <repository-url>
cd mcp-linker-sdk
pip install -e .
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åŸºæœ¬ä½¿ç”¨

```python
import asyncio
from linker.manager import MCPServiceManager

async def main():
    # åˆ›å»ºæœåŠ¡ç®¡ç†å™¨
    manager = MCPServiceManager()
    
    # æ³¨å†Œå•ä¸ªæœåŠ¡
    await manager.register_service(
        service_name="my-service",
        mcp_url="http://example.com/mcp/",
        headers={"Authorization": "Bearer token"},
        description="æˆ‘çš„ MCP æœåŠ¡"
    )
    
    # è·å–æ‰€æœ‰æœåŠ¡
    services = manager.get_all_services()
    print(f"å·²æ³¨å†ŒæœåŠ¡: {services}")
    
    # è·å–æœåŠ¡çš„å·¥å…·åˆ—è¡¨
    tools = manager.get_all_tools_by_service("my-service")
    print(f"å¯ç”¨å·¥å…·: {tools}")
    
    # æ‰§è¡Œå·¥å…·
    result = await manager.execute_tool(
        service_name="my-service",
        tool_name="some-tool",
        input_data={"param": "value"}
    )
    print(f"æ‰§è¡Œç»“æœ: {result}")

asyncio.run(main())
```

### ä»é…ç½®æ–‡ä»¶æ³¨å†ŒæœåŠ¡

```python
import asyncio
from linker.manager import MCPServiceManager

async def main():
    manager = MCPServiceManager()
    
    # ä»é…ç½®æ–‡ä»¶æ‰¹é‡æ³¨å†Œ
    results = await manager.register_services_from_file("./mcp.json")
    
    # æŸ¥çœ‹æ³¨å†Œç»“æœ
    for service_name, success in results.items():
        status = "æˆåŠŸ" if success else "å¤±è´¥"
        print(f"æœåŠ¡ {service_name}: {status}")

asyncio.run(main())
```

## ğŸ—ï¸ æ ¸å¿ƒç»„ä»¶

### MCPServiceManager

MCP æœåŠ¡ç®¡ç†å™¨ï¼Œè´Ÿè´£æœåŠ¡çš„æ³¨å†Œã€ç®¡ç†å’Œå·¥å…·è°ƒç”¨ã€‚

**ä¸»è¦æ–¹æ³•ï¼š**

- `register_service()` - æ³¨å†Œå•ä¸ª MCP æœåŠ¡
- `register_services_from_file()` - ä»é…ç½®æ–‡ä»¶æ‰¹é‡æ³¨å†ŒæœåŠ¡
- `get_all_services()` - è·å–æ‰€æœ‰å·²æ³¨å†Œçš„æœåŠ¡
- `get_all_tools_by_service()` - è·å–æŒ‡å®šæœåŠ¡çš„å·¥å…·åˆ—è¡¨
- `get_tool_info()` - è·å–å·¥å…·çš„è¯¦ç»†ä¿¡æ¯
- `execute_tool()` - æ‰§è¡ŒæŒ‡å®šçš„å·¥å…·
- `close_all()` - å…³é—­æ‰€æœ‰å®¢æˆ·ç«¯è¿æ¥

### ServiceInfo

æœåŠ¡ä¿¡æ¯æ•°æ®ç±»ï¼ŒåŒ…å«ï¼š

- `name` - æœåŠ¡åç§°
- `description` - æœåŠ¡æè¿°
- `tools` - å·¥å…·å­—å…¸ (å·¥å…·å -> Tool å¯¹è±¡)

## ğŸ“– ä½¿ç”¨æŒ‡å—

### 1. æ³¨å†ŒæœåŠ¡

#### æ–¹å¼ä¸€ï¼šå•ä¸ªæ³¨å†Œ

```python
await manager.register_service(
    service_name="github",
    mcp_url="http://github-mcp.example.com/mcp",
    headers={"Authorization": "Bearer your-token"},
    description="GitHub MCP æœåŠ¡"
)
```

#### æ–¹å¼äºŒï¼šé…ç½®æ–‡ä»¶æ‰¹é‡æ³¨å†Œ

åˆ›å»º `mcp.json` é…ç½®æ–‡ä»¶ï¼š

```json
{
    "mcpServers": {
        "github": {
            "type": "streamable_http",
            "url": "http://github-mcp.example.com/mcp",
            "headers": {
                "Authorization": "Bearer your-token"
            },
            "timeout": 30000
        },
        "amap": {
            "type": "streamable_http",
            "url": "http://amap-mcp.example.com/mcp",
            "headers": {
                "Authorization": "Bearer your-token"
            }
        }
    }
}
```

ç„¶åæ‰¹é‡æ³¨å†Œï¼š

```python
results = await manager.register_services_from_file("./mcp.json")
```

### 2. å‘ç°å·¥å…·

```python
# è·å–æ‰€æœ‰æœåŠ¡
services = manager.get_all_services()
# è¿”å›: [{"name": "github", "description": "GitHub MCP æœåŠ¡"}, ...]

# è·å–æœåŠ¡çš„å·¥å…·åˆ—è¡¨
tools = manager.get_all_tools_by_service("github")
# è¿”å›: [{"name": "search_repos", "description": "æœç´¢ä»“åº“"}, ...]

# è·å–å·¥å…·è¯¦ç»†ä¿¡æ¯
tool_info = manager.get_tool_info("github", "search_repos")
# è¿”å›: {"name": "search_repos", "description": "...", "inputSchema": {...}}
```

### 3. æ‰§è¡Œå·¥å…·

```python
result = await manager.execute_tool(
    service_name="github",
    tool_name="search_repos",
    input_data={"query": "python", "limit": 10}
)
print(result)  # JSON å­—ç¬¦ä¸²æˆ–æ–‡æœ¬ç»“æœ
```

### 4. é”™è¯¯å¤„ç†

```python
try:
    result = await manager.execute_tool(
        service_name="github",
        tool_name="search_repos",
        input_data={"query": "python"}
    )
except ValueError as e:
    print(f"å‚æ•°é”™è¯¯: {e}")
except RuntimeError as e:
    print(f"æ‰§è¡Œå¤±è´¥: {e}")
```

## ğŸ“ é…ç½®æ–‡ä»¶æ ¼å¼

`mcp.json` é…ç½®æ–‡ä»¶ç»“æ„ï¼š

```json
{
    "mcpServers": {
        "æœåŠ¡åç§°": {
            "type": "streamable_http",
            "url": "MCP æœåŠ¡çš„ URL åœ°å€",
            "headers": {
                "Authorization": "è®¤è¯ä»¤ç‰Œï¼ˆå¯é€‰ï¼‰",
                "å…¶ä»–è‡ªå®šä¹‰å¤´": "å€¼"
            },
            "timeout": 30000,
            "description": "æœåŠ¡æè¿°ï¼ˆå¯é€‰ï¼‰"
        }
    }
}
```

**å­—æ®µè¯´æ˜ï¼š**

- `type` - ä¼ è¾“ç±»å‹ï¼Œç›®å‰ä»…æ”¯æŒ `streamable_http`
- `url` - MCP æœåŠ¡çš„ URL åœ°å€ï¼ˆå¿…å¡«ï¼‰
- `headers` - HTTP è¯·æ±‚å¤´ï¼ˆå¯é€‰ï¼‰
- `timeout` - è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ¯«ç§’ï¼ˆå¯é€‰ï¼‰
- `description` - æœåŠ¡æè¿°ï¼ˆå¯é€‰ï¼‰

## ğŸ¤– AgentScope é›†æˆ

SDK æä¾›äº† AgentScope æ¡†æ¶çš„å·¥å…·åŒ…è£…å™¨ï¼Œå¯ä»¥å°† MCP å·¥å…·è½¬æ¢ä¸º AgentScope å·¥å…·ã€‚

### åˆ›å»º AgentScope å·¥å…·

```python
from linker.manager import MCPServiceManager
from linker.agentscope_tool import (
    create_get_all_mcp_services_tool,
    create_get_service_tools_tool,
    create_get_tool_info_tool,
    create_execute_tool
)

# åˆ›å»ºç®¡ç†å™¨
manager = MCPServiceManager()
await manager.register_services_from_file("./mcp.json")

# åˆ›å»º AgentScope å·¥å…·
get_services = create_get_all_mcp_services_tool(manager)
get_tools = create_get_service_tools_tool(manager)
get_info = create_get_tool_info_tool(manager)
execute = create_execute_tool(manager)

# åœ¨ AgentScope ä¸­ä½¿ç”¨
response = get_services()
print(response.content)
```

### å¯ç”¨çš„ AgentScope å·¥å…·

1. **get_all_mcp_services** - è·å–æ‰€æœ‰å·²æ³¨å†Œçš„ MCP æœåŠ¡åˆ—è¡¨
2. **get_service_tools** - è·å–æŒ‡å®šæœåŠ¡çš„å·¥å…·åˆ—è¡¨
3. **get_tool_info** - è·å–å·¥å…·çš„è¯¦ç»†ä¿¡æ¯
4. **execute_tool** - æ‰§è¡ŒæŒ‡å®šçš„ MCP å·¥å…·

## ğŸ’¡ ç¤ºä¾‹

### ç¤ºä¾‹ 1: åˆ›å»º MCP æœåŠ¡å™¨

å‚è€ƒ `examples/mcp_server.py`ï¼Œä½¿ç”¨ FastMCP åˆ›å»ºä¸€ä¸ª MCP æœåŠ¡å™¨ï¼š

```python
from mcp.server.fastmcp import FastMCP
from linker.manager import MCPServiceManager
import asyncio

mcp = FastMCP("mcp-linker")
mcp_manager = MCPServiceManager()

@mcp.tool()
def get_all_services():
    """è·å–æ‰€æœ‰å·²æ³¨å†Œçš„ MCP æœåŠ¡åˆ—è¡¨"""
    return mcp_manager.get_all_services()

@mcp.tool()
async def execute_tool(service_name: str, tool_name: str, input_data: dict):
    """æ‰§è¡ŒæŒ‡å®šçš„ MCP å·¥å…·"""
    return await mcp_manager.execute_tool(service_name, tool_name, input_data)

if __name__ == "__main__":
    asyncio.run(mcp_manager.register_services_from_file("./mcp.json"))
    mcp.run(transport="streamable-http")
```

### ç¤ºä¾‹ 2: é“¾å¼è°ƒç”¨

```python
async def demo():
    manager = MCPServiceManager()
    await manager.register_services_from_file("./mcp.json")
    
    # 1. è·å–æ‰€æœ‰æœåŠ¡
    services = manager.get_all_services()
    print(f"å¯ç”¨æœåŠ¡: {[s['name'] for s in services]}")
    
    # 2. è·å–ç¬¬ä¸€ä¸ªæœåŠ¡çš„å·¥å…·
    service_name = services[0]['name']
    tools = manager.get_all_tools_by_service(service_name)
    print(f"{service_name} çš„å·¥å…·: {[t['name'] for t in tools]}")
    
    # 3. è·å–ç¬¬ä¸€ä¸ªå·¥å…·çš„è¯¦ç»†ä¿¡æ¯
    tool_name = tools[0]['name']
    tool_info = manager.get_tool_info(service_name, tool_name)
    print(f"å·¥å…·ä¿¡æ¯: {tool_info}")
    
    # 4. æ‰§è¡Œå·¥å…·ï¼ˆæ ¹æ®å®é™…çš„ inputSchema æ„é€ å‚æ•°ï¼‰
    # result = await manager.execute_tool(service_name, tool_name, {...})

asyncio.run(demo())
```

## ğŸ“š API æ–‡æ¡£

### MCPServiceManager

#### `__init__()`

åˆ›å»º MCP æœåŠ¡ç®¡ç†å™¨å®ä¾‹ã€‚

#### `async register_service(service_name, mcp_url, headers=None, description=None)`

æ³¨å†Œå•ä¸ª MCP æœåŠ¡ã€‚

**å‚æ•°ï¼š**
- `service_name` (str) - æœåŠ¡åç§°
- `mcp_url` (str) - MCP æœåŠ¡ URL
- `headers` (dict, å¯é€‰) - HTTP è¯·æ±‚å¤´
- `description` (str, å¯é€‰) - æœåŠ¡æè¿°

**å¼‚å¸¸ï¼š**
- `ValueError` - æœåŠ¡åç§°å·²å­˜åœ¨
- `ConnectionError` - æ— æ³•è¿æ¥åˆ° MCP æœåŠ¡

#### `async register_services_from_file(config_path)`

ä»é…ç½®æ–‡ä»¶æ‰¹é‡æ³¨å†ŒæœåŠ¡ã€‚

**å‚æ•°ï¼š**
- `config_path` (str | Path) - é…ç½®æ–‡ä»¶è·¯å¾„

**è¿”å›ï¼š**
- `Dict[str, bool]` - æœåŠ¡åç§°åˆ°æ³¨å†Œç»“æœçš„æ˜ å°„

**å¼‚å¸¸ï¼š**
- `FileNotFoundError` - é…ç½®æ–‡ä»¶ä¸å­˜åœ¨
- `json.JSONDecodeError` - é…ç½®æ–‡ä»¶æ ¼å¼é”™è¯¯
- `ValueError` - é…ç½®æ–‡ä»¶ç¼ºå°‘å¿…éœ€å­—æ®µ

#### `get_all_services()`

è·å–æ‰€æœ‰å·²æ³¨å†Œçš„æœåŠ¡ä¿¡æ¯ã€‚

**è¿”å›ï¼š**
- `List[Dict[str, str]]` - æœåŠ¡åˆ—è¡¨ï¼Œæ¯ä¸ªæœåŠ¡åŒ…å« name å’Œ description

#### `get_all_tools_by_service(service_name)`

è·å–æŒ‡å®šæœåŠ¡çš„æ‰€æœ‰å·¥å…·ã€‚

**å‚æ•°ï¼š**
- `service_name` (str) - æœåŠ¡åç§°

**è¿”å›ï¼š**
- `List[Dict[str, str]]` - å·¥å…·åˆ—è¡¨ï¼Œæ¯ä¸ªå·¥å…·åŒ…å« name å’Œ description

**å¼‚å¸¸ï¼š**
- `ValueError` - æœåŠ¡ä¸å­˜åœ¨

#### `get_tool_info(service_name, tool_name)`

è·å–å·¥å…·çš„è¯¦ç»†ä¿¡æ¯ã€‚

**å‚æ•°ï¼š**
- `service_name` (str) - æœåŠ¡åç§°
- `tool_name` (str) - å·¥å…·åç§°

**è¿”å›ï¼š**
- `Dict[str, Any]` - å·¥å…·ä¿¡æ¯ï¼ŒåŒ…å« nameã€description å’Œ inputSchema

**å¼‚å¸¸ï¼š**
- `ValueError` - æœåŠ¡æˆ–å·¥å…·ä¸å­˜åœ¨

#### `async execute_tool(service_name, tool_name, input_data)`

æ‰§è¡ŒæŒ‡å®šçš„ MCP å·¥å…·ã€‚

**å‚æ•°ï¼š**
- `service_name` (str) - æœåŠ¡åç§°
- `tool_name` (str) - å·¥å…·åç§°
- `input_data` (dict) - å·¥å…·è¾“å…¥å‚æ•°

**è¿”å›ï¼š**
- `str` - å·¥å…·æ‰§è¡Œç»“æœï¼ˆJSON å­—ç¬¦ä¸²æˆ–æ–‡æœ¬ï¼‰

**å¼‚å¸¸ï¼š**
- `ValueError` - æœåŠ¡ã€å·¥å…·ä¸å­˜åœ¨æˆ–å‚æ•°é”™è¯¯
- `RuntimeError` - å·¥å…·æ‰§è¡Œå¤±è´¥

#### `async close_all()`

å…³é—­æ‰€æœ‰ MCP å®¢æˆ·ç«¯è¿æ¥ã€‚

## ğŸ”§ æŠ€æœ¯æ ˆ

- **Python 3.8+**
- **asyncio** - å¼‚æ­¥ I/O
- **AgentScope** - Agent æ¡†æ¶é›†æˆ
- **MCP (Model Context Protocol)** - åè®®å®ç°
- **Pydantic** - æ•°æ®éªŒè¯
- **FastMCP** - MCP æœåŠ¡å™¨æ¡†æ¶ï¼ˆç¤ºä¾‹ä½¿ç”¨ï¼‰

## ğŸ“„ è®¸å¯è¯

[åœ¨æ­¤æ·»åŠ è®¸å¯è¯ä¿¡æ¯]

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“§ è”ç³»æ–¹å¼

[åœ¨æ­¤æ·»åŠ è”ç³»æ–¹å¼]

---

**æ³¨æ„ï¼š** æœ¬ SDK ç›®å‰ä»…æ”¯æŒ `streamable_http` ä¼ è¾“ç±»å‹çš„ MCP æœåŠ¡ã€‚
